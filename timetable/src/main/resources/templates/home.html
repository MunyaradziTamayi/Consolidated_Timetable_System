<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard UI</title>
  <style>
    /* Reset some default styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      height: 100vh;
      width: 100vw;
      font-family: sans-serif;
      background-color: #ffffff; /* Whole background is white */
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
    }

    .dashboard-container {
      width: 100%;
      text-align: center;
    }

    .logo {
      width: 160px; /* Increased size */
      height: 160px; /* Increased size */
      object-fit: contain;
      margin-bottom: 20px;
    }

    .dashboard-title {
      font-size: 28px;
      color: #252525;
      font-weight: 800;
      margin-bottom: 10px;
    }

    .dashboard-description {
      font-size: 16px;
      color: #666666;
      margin-bottom: 30px;
    }

    /* Dropdown Styles */
    .dropdown {
  position: absolute;
  top: 20px;
  right: 20px;
  background-color: #f4f6f8;
  border: 1px solid #d0d0d0;
  border-radius: 16px;
  width: 180px;
  transition: 0.3s ease-in-out
}

.dropdownbutton{
    display: flex;
  width: 100%;
  background-color: white;
  border-radius: 16px;
}


.dropdownbutton img{
    width: 16px;
    height: 16px;
    align-self: center;
    margin: 0px 16px 0 16px;
}

.dropdownbutton h1 {
  background-color: #ffffff;
  color: #252525;
  padding: 8px 0px;
  text-align: left;
  border: none;
  transform: translateX(10px);
  cursor: pointer;
  font-size: 14px;
  font-weight: 400;
  transition: 0.3s ease-in-out
}

.dropdown-content {
  position: absolute;
  top: 38px;
  right: 1px;
  width: 180px;
  background-color: #ffffff;
  border-radius: 16px;
  border-color: #d0d0d0;
  border-style: solid;
  border-width: 1px;
  min-width: 160px;
  z-index: 1;
  /* Initially hidden, opacity 0 and moved down */
  opacity: 0;
  transform: translateY(16px); /* Slightly moved upwards */
  pointer-events: none; /* Prevent clicking when not visible */
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.dropdown-content div {
  display: flex;
  width: 1fr;
}

.dropdown-content img {
  width: 20px;
  height: 20px;
  margin-left: 4px;
  margin-right: 16px;
}

.dropdown-content h1 {
  color: #252525;
  font-weight: 400;
  font-size: 16px;
  margin-right: 8px;
}

.dropdown-content a {
  color: #333;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  font-size: 16px;
}

.dropdown-content a:hover {
  background-color: #ddd;
}

/* Show the dropdown when the parent is hovered */
.dropdown:hover .dropdown-content {
  opacity: 1;
  transform: translateY(0); /* Slide into place */
  pointer-events: auto; /* Allow clicking */
}



    /* Panel Styles */
    .panels {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
    }

    .panel {
      width: 30%;
      padding: 28px 16px;
      display: grid;
      grid-template-rows: 50% 50%;
      background-color: #ffffff; /* White background */
      border: 1px solid #dadada; /* Border color updated */
      border-radius: 16px; /* Border radius */
      text-align: center;
    }

    .panel h3 {
      font-size: 14px;
      margin-bottom: 10px;
      color: #505050;
      font-weight: 400;
    }

    .panel p {
      font-size: 24px;
      font-weight: bold;
      color: #252525;
      align-content: center;
    }

    /* Table Styles */
    table {
      width: 100%;
      margin-top: 30px;
      border-collapse: collapse;
      background-color: #d0d0d0;
      border-radius: 16px; /* Rounded corners for the table */
      overflow: hidden; /* Ensures the corners are clipped */
      border: 1px solid #dadada; /* Table surrounding border */
    }

    th, td {
      padding: 12px;
      text-align: left;
      font-size: 14px;
      border-left: 1px solid #dadada; /* Dividing line between columns */
      border-top: 1px solid #dadada;  /* Dividing line between rows */
    }

    th {
        font-weight: 400;
        font-size: 12px;
      background-color: #ffffff; /* White background for headings */
      color: #252525; /* Default text color */
    }

    tr{
        background-color: white;
    }


    tr:hover {
      background-color: #f1f1f1;
    }

    td:first-child, th:first-child {
      border-left: none; /* Remove left border from the first column */
    }

    .editBox{
        position: relative;
    }

    .editBox div{
        opacity: 0;
        transition: 300ms ease-in-out;
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: #40404040;
        left: 0;
        top: 0;
        display: grid;

    }

    .editBox button{
        background-color: #252525;
        color: white;
        border: none;
        transform: translateY(10px);
        transition: 300ms ease-in-out;
        padding: 8px 16px;
        border-radius: 16px;
        justify-self: center;
        align-self: center;
    }

    

    .editBox:hover div{
        opacity: 1;

    }

    .editBox:hover button{
        
        transform: translateY(0px);
    }

    


    dialog{
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    background: #00000040;
    border-width: 0;
    border-radius: 0;
    display: flex;
    justify-content: center;

}

dialog div{
    background-color: white;
    border-radius: 16px;
    padding: 24px;
    width: 240px;
    height: 100px;
    display: grid;
    grid-template-rows: auto auto;
    justify-content: center;
    align-self: center;
}

dialog div img{
    width: 24px;
    height: 24px;
    justify-self: center;
    align-self: center;
}

dialog div h1{
    grid-row: 2;
    font-size: 16px;
    font-family: sans-serif;
    color: #252525;
    font-weight: 400;
}

.bottom-sheet-container {
    position: fixed;
    left: 0;
    bottom: 0;
    width: calc(100% - 40px);
    background-color: white;
    border-radius: 16px;
    margin: 20px;
    border-color: #ccc;
    border-width: 1px;
    border-style: solid;
    transform: translateY(calc(106%)); /* Initially hidden */
    transition: transform 0.6s ease-in-out;
}

.bottom-sheet-container.open {
    transform: translateY(0%); /* Slide up when open class is added */
}

.bottom-sheet-header {
    padding: 32px 48px 0px 48px;
    display: grid;
    grid-template-columns: 1fr max-content;
}

.bottom-sheet-header h3 {
    font-size: 20px;
    color: #252525;
    font-weight: 600;
}

.bottom-sheet-header button {
    align-self: center;
    background-color: white;
    border-radius: 16px;
    border: none;
    height: 32px;
    width: 32px;
    display: grid;
    align-items: center;
    justify-content: center;
}

.bottom-sheet-header button:hover {
    background-color: red;
}

.bottom-sheet-header button:hover img {
    filter: invert();
}

.bottom-sheet-header img {
    width: 16px;
    height: 16px;

}

.bottom-sheet-container p{
    padding: 0px 0px 24px 48px;
    font-size: 12px;
    color: #252525;
    font-weight: 400;
}

.bottom-sheet-content {
    display: grid;
    margin: 0px 48px 24px 48px;
    overflow-y: auto;
    max-height: 400px;

}

.bottom-sheet-content button{
    background-color: #252525;
    border-radius: 16px;
    border: none;
    color: white;
    padding: 8px 16px;
    transition: 300ms ease-in-out;
}

.bottom-sheet-content button:hover{
    background-color: #757575;
    color: white;
}


.bottom-sheet-footer {
    display: grid;
    align-items: end;
    justify-content: end;
    grid-template-columns: max-content 20px max-content;
    padding: 32px 48px;
}

.bottom-sheet-footer button {
    background-color: white;
    border-radius: 16px;
    border-width: 1px;
    border-color: #808080;
    border-style: solid;
    color: #505050;
    font-weight: 400;
    font-size: 14px;
    padding: 8px;
    width: 150px;
    transition: 0.3s ease-in-out;
}

.bottom-sheet-footer button:hover {
    background-color: #505050;
    color: white;
}



  </style>
</head>
<body>
  <div class="dashboard-container">
    <div class="dashboard-header">
      <img src="/images/hit_logo.png" alt="Logo" class="logo" />
      <h1 class="dashboard-title">Harare Institute of Technology</h1>
      <p class="dashboard-description">
        Success through innovation
      </p>
    </div>

    <!-- Dropdown Menu -->
    <div class="dropdown">
        <div class="dropdownbutton">
            <img src="/svg/menu.svg">
            <h1>Actions</h1>
        </div>
      
      <div class="dropdown-content">
        <a  style="border-radius: 15px 15px 0px 0px;" href="/assign_staff"
            onclick="displayLoadingScreen()">
            <div>
            <img src="/svg/generate_icon.svg">
            <h1>Assign staff</h1>
            </div>
        </a>
        <a href="/generate_pdf"
            onclick="displayLoadingScreen()">
            <div>
            <img src="/svg/pdf_icon.svg">
            <h1>Create PDF</h1>
            </div>
        </a>
        <a href="/send-emails"
            onclick="displayLoadingScreen()">
            <div>
            <img src="/svg/email_icon.svg">
            <h1>Send emails</h1>
            </div>
        </a>
        <a style="border-radius: 0px 0px 15px 15px;" href="/set_deadline_period"
            onclick="displayLoadingScreen()">
            <div>
            <img src="/svg/time.svg">
            <h1>Set deadline</h1>
            </div>
        </a>
      </div>
    </div>

    <!-- Panels for Statistics -->
    <div class="panels">
      <div class="panel">
        <h3>Available invigilators</h3>
        <p>128/145</p>
      </div>
      <div class="panel">
        <h3>Exams per Invigilator</h3>
        <p>7</p>
      </div>
      <div class="panel">
        <h3>Deadline</h3>
        <p>16/05/24</p>
      </div>
    </div>

    <!-- Table -->
    <table>
      <thead>
        <tr>
            <th>Date</th>
            <th>Time</th>
            <th>Exam</th>
            <th>Invigilators</th>
            <th>Assistant Invigilator</th>
            <th>Group Allocation</th>
            <th>Venue</th>
            <th>Administrator</th>
            <th>In attendance and laying of material</th>
            <th>Chief Invigilator</th>
          </tr>
      </thead>
      <tbody>
        <tr th:each="timetableEntity: ${timetableEntities}">
            <td th:text="${timetableEntity.date}"></td>
            <td th:text="${timetableEntity.time}"></td>
            <td th:text="${timetableEntity.exam}"></td>
            <td class="editBox" >
                <p th:text="${timetableEntity.invigilators}" ></p>
                <div>
                    <button th:data-id="${timetableEntity.examID}"
                            th:onclick="|openBottomSheet(this.getAttribute('data-id'))|">Edit</button>
                </div>
                
            </td>
            <td th:text="${timetableEntity.assistantInvigilator}"></td>
            <td th:text="${timetableEntity.groupAllocation}"></td>
            <td th:text="${timetableEntity.venue}"></td>
            <td class="editBox">
                <p th:text="${timetableEntity.administrator}" ></p>
                <div>
                    <button th:data-date="${timetableEntity.date}"
                            th:data-time="${timetableEntity.time}"
                            th:data-venue="${timetableEntity.venue}"
                            th:data-type="administrator"
                            th:onclick="|openStaffBottomSheet(this.getAttribute('data-date'),this.getAttribute('data-time'),this.getAttribute('data-venue'),this.getAttribute('data-type'))|">Edit</button>
                </div>
            </td>
            <td th:text="${timetableEntity.inAttendances}"></td>
            <td th:text="${timetableEntity.chiefInvigilator}"></td>
      
      
          </tr>
      </tbody>
    </table>

    <dialog id="loadingDialog" style="visibility: collapse">

        <div>
    
          <img src="/images/loading.gif">
    
          <h1>Please wait</h1>
    
        </div>
    
      </dialog>

  </div>

  <div id="bottomSheet" class="bottom-sheet-container">

    <div class="bottom-sheet-header">
        <h3>Edit invigilators</h3>

        <button onclick="closeBottomSheet()">
            <img src="/svg/close.svg" alt="close">
        </button>
    </div>
    <p>ISE:2001 - 16 April 2025 - 09:00</p>

    <div class="bottom-sheet-content">
        <table id="invTable">
            <thead>
              <tr>
                  <th></th>
                  <th>Name</th>
                  <th>Surname</th>
                  <th>Email</th>
                  <th></th>
                </tr>
            </thead>
            <tbody>


            </tbody>
          </table>

    </div>

    <div class="bottom-sheet-footer">
        <button onclick="closeBottomSheet()">Cancel</button>
        <div></div>
        <button style="background-color: #252525; color: white;">Save</button>

    </div>
</div>


  <script>

    window.history.forward();
    const bottomSheet = document.getElementById('bottomSheet');
    var list=[];
    var ol
  
    function displayLoadingScreen(){
      document.getElementById('loadingDialog').style.visibility = 'visible';
    }

    function openBottomSheet(examID) {
        bottomSheet.classList.add('open');
        fetchData(examID);

    }

    function openStaffBottomSheet(date,time,venue,type){
        bottomSheet.classList.add('open');
        fetchStaffData(date,time,venue,type);
    }

    function closeBottomSheet() {
        bottomSheet.classList.remove('open');
    }

    async function fetchData(examID) {

        const tableBody = document.querySelector('#invTable tbody');
        tableBody.innerHTML = '';

        try {

            const response = await fetch('/invigilator_list', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: examID,
            });

            if (response.ok) {

                const invigilators = await response.json();

                invigilators.forEach(invigilator => {
                    const row = document.createElement('tr');

                    if(invigilator.assigned===true){
                        row.innerHTML = `
          <td>${invigilator.counter}</td>
          <td>${invigilator.name}</td>
          <td>${invigilator.surname}</td>
          <td>${invigilator.email}</td>
          <td><button style="background-color: #E00000;">Remove</button></td>
        `;
                    }else{
                        row.innerHTML = `
          <td>${invigilator.counter}</td>
          <td>${invigilator.name}</td>
          <td>${invigilator.surname}</td>
          <td>${invigilator.email}</td>
          <td><button>Add</button></td>
        `;
                    }

                    tableBody.appendChild(row);
                });

            } else {
                alert(response.statusText);

            }

        } catch (error) {
            alert(error);
            console.error('Upload error:', error);
        }


    }

    async function fetchStaffData(date,time,venue,type){

        const tableBody = document.querySelector('#invTable tbody');
        tableBody.innerHTML = '';

        try {

            const body={
                date:date,
                time:time,
                venue:venue,
                type:type
            }

            const response = await fetch('/staff_list', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body),
            });

            if (response.ok) {

                const staff = await response.json();

                staff.forEach(member => {
                    const row = document.createElement('tr');

                    if(member.assigned===true){
                        row.innerHTML = `
          <td>${member.counter}</td>
          <td>${member.name}</td>
          <td>${member.surname}</td>
          <td>${member.email}</td>
          <td><button style="background-color: #E00000;">Remove</button></td>
        `;
                    }else{
                        row.innerHTML = `
          <td>${member.counter}</td>
          <td>${member.name}</td>
          <td>${member.surname}</td>
          <td>${member.email}</td>
          <td><button>Add</button></td>
        `;
                    }

                    tableBody.appendChild(row);
                });

            } else {
                alert(response.statusText);

            }

        } catch (error) {
            alert(error);
            console.error('Upload error:', error);
        }


    }




  </script>
</body>
</html>
